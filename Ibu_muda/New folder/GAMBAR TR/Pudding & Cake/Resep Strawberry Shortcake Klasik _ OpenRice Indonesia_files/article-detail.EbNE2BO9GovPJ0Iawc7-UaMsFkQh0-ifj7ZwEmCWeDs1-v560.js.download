"use strict";OpenriceApp.ArticlePhotoModal={};OpenriceApp.ArticlePhotoModal.Controller={init:function(){var n=this;n.initModalEvents();n.initPhotoModel()},initPhotoModel:function(){var n=function(n,t){var i=5,r=i,u=n.position().left+parseInt(n.css("margin-left"))+n.outerWidth()-t.outerWidth()-i;t.css("top",r+"px").css("left",u+"px")},t=function(n,t){var i=n.position().left+parseInt(n.css("margin-left"));t.css("width",n.outerWidth()).css("left",i+"px")};$(window).resize(function(){$(".js-article-modal-photo").each(function(){var r=$(this).siblings(".js-article-modal-photo-enlarge"),i;r.length>0&&n($(this),r);i=$(this).siblings(".js-article-modal-photo-caption");i.length>0&&t($(this),i)})});$(".js-article-photo-parent img").one("load",function(){var i,r,u;$(this).width()>=200&&$(this).height()>=200&&(i=$(this).attr("alt"),$(this).addClass("article-modal-photo js-article-modal-photo"),$(this).wrap($('<div class="article-modal-photo-wrapper"><\/div>')),r=$('<div class="article-modal-photo-enlarge js-article-modal-photo-enlarge or-sprite h_advertorial_icon_enlarge_desktop"><\/div>'),$(this).after(r),n($(this),r),i&&(u=$('<div class="article-modal-photo-caption js-article-modal-photo-caption"><\/div>').html(i),t($(this),u),$(this).after(u)))}).each(function(){(this.complete||$(this).height()>0)&&$(this).load()});$(".js-article-photo-parent").on("click",".js-article-modal-photo",function(){var n,t;$(".js-model-photo").css("background-image","url("+$(this).attr("src")+")");n=$(this).attr("alt");n?$(".js-model-caption").show().html($(this).attr("alt")):$(".js-model-caption").hide();$("#article-modal-photo-modal").modal("show");t=$("#article-modal-photo-modal").find(".js-close, .modal-backdrop");$(t).off("click").on("click",function(){$("#article-modal-photo-modal").modal("hide")})})},initModalEvents:function(){var n="#article-modal-photo-modal";$(n).on("show.bs.modal",function(){var n=(0-$(window).scrollTop()).toString()+"px";$("#global-container:not(.subview-active)").attr("style","top:"+n+" !important;");$("#global-container").addClass("subview-active")});$(n).on("hidden.bs.modal",function(){$("#global-container").removeClass("subview-active");var n=Math.abs(parseInt($("#global-container")[0].style.top,10));isNaN(n)||$(window).scrollTop(n)})}};OpenriceApp.Widgets.BookmarkCategory=function(){};OpenriceApp.Widgets.BookmarkCategory.prototype.init=function(n){var t=this,i,r;if(OpenriceApp.Class.Event.call(this),t.xhr={bookmark:[]},t.defaultToastrTimeout=toastr.options.timeOut,!!n)for(i in n)t[i]=n[i];r={preselect:t.preselect};OpenriceApp.Api.Poi.getBookmarkCategory(r,function(n){!n.defaultBookmarkCategoryId||(t.defaultBookmarkCategoryId=n.defaultBookmarkCategoryId);t.refreshCategoryHtml(n)})};OpenriceApp.Widgets.BookmarkCategory.prototype.refreshCategoryHtml=function(n){var t=this,i=$("#bookmarkCategoryTemplate").html(),r=Handlebars.compile(i);t.defaultHtml=r({latestBookmarkCategories:n.latestBookmarkCategories,bookmarkedCategories:n.bookmarkedCategories});$(".js-bookmark-category-wrapper").on("click",function(n){n.stopPropagation();n.preventDefault()})};OpenriceApp.Widgets.BookmarkCategory.prototype.initCategoryBlock=function(n,t){var i=this,r;i.selector=n;i.preselect=!0;i.defaultBookmarkCategoryId=undefined;i.categoryBlock={};i.bookmarkButton=t;r={preselect:i.preselect};OpenriceApp.Api.Poi.getBookmarkCategory(r,function(n){!n.defaultBookmarkCategoryId||(i.defaultBookmarkCategoryId=n.defaultBookmarkCategoryId);i.categoryBlock={poiId:$(i.selector).attr("data-poi-id"),selectedItems:!i.defaultBookmarkCategoryId?[]:[i.defaultBookmarkCategoryId],hasCategoryItemChange:!1};i.refreshCategoryHtml(n)});$(".js-bookmark-category-wrapper").empty();$(i.selector).html(i.defaultHtml);i.showCategoryBlock(i.selector);i.initCategoryBlockEventListener()};OpenriceApp.Widgets.BookmarkCategory.prototype.initCategoryBlockEventListener=function(){var n=this;n.onClickCategoryBlock();n.onClickShowCreateCategoryInputButton();n.onClickCreateCategoryButton();n.onClickPrivateButton();n.bindCategoryItemEventListener()};OpenriceApp.Widgets.BookmarkCategory.prototype.bindCategoryItemEventListener=function(){var n=this;n.onClickCategoryItems();n.onClickEditCategoryButton();n.onClickEditCategoryDoneButton();n.onClickRemoveCategoryButton()};OpenriceApp.Widgets.BookmarkCategory.prototype.showCategoryBlock=function(){var n=this;$(n.selector).removeClass("hidden");$(n.bookmarkButton).addClass("show-bookmark-category-block-arrow");$(document).one("click",function(){n.hideCategoryBlock(n,!0)})};OpenriceApp.Widgets.BookmarkCategory.prototype.hideCategoryBlock=function(n,t){var i=this;t&&n.submitBookmarkStatus();$(i.bookmarkButton).removeClass("show-bookmark-category-block-arrow");$(i.selector).addClass("hidden");i.bookmarkButton=undefined};OpenriceApp.Widgets.BookmarkCategory.prototype.onClickCategoryBlock=function(){$(".js-bookmark-category-wrapper").on("click",function(n){n.stopPropagation()})};OpenriceApp.Widgets.BookmarkCategory.prototype.onClickShowCreateCategoryInputButton=function(){var n=this;$(n.selector).find(".js-show-create-category-input-button").off("click").on("click",function(){n.hideErrorMessage();$(".show-edit-input").removeClass("show-edit-input");$(n.selector).find(".js-bookmark-create-category-container").addClass("show-create-bookmark-category-input-container");$(n.selector).find(".js-create-bookmark-category-input").focus()})};OpenriceApp.Widgets.BookmarkCategory.prototype.hideCreateBookmarkCategoryInputField=function(){var n=this;$(n.selector).find(".js-bookmark-create-category-container").removeClass("show-create-bookmark-category-input-container");$(n.selector).find(".js-create-bookmark-category-input").val("")};OpenriceApp.Widgets.BookmarkCategory.prototype.onClickCreateCategoryButton=function(){var n=this,t=$(n.selector).find(".js-create-category-btn");$(n.selector).find(".js-create-bookmark-category-input").on({input:function(){n.hideErrorMessage();t.removeClass("has-error")},keydown:function(t){t.keyCode===13&&n.processCreateCategory()}});t.off("click").on("click",function(){n.hideErrorMessage();n.processCreateCategory()})};OpenriceApp.Widgets.BookmarkCategory.prototype.processCreateCategory=function(){function e(t){if(!!t.error)return!1;if(!!t.errorMessage)return $(u).addClass("has-error"),$(f).text(t.errorMessage).show(),!1;var i=t.newBookmarkCategory.bookmarkCategoryId,r=t.newBookmarkCategory.name;n.addSelectedItem(i);n.categoryBlock.hasCategoryItemChange=!0;o(i,r)}function o(t,i){var u=$("#bookmarkCategoryContentCellTemplate").html(),f=Handlebars.compile(u),e=f({bookmarkCategoryId:t,name:i,isBookmarked:!0});$(r).find(".bookmark-category-title").after(e);n.hideCategoryBlock(n,!0)}var n=this,i=$(n.selector).find(".js-create-bookmark-category-input"),r=$(n.selector).find(".js-all-bookmark-categories"),u=$(n.selector).find(".js-create-category-btn"),f=$(n.selector).find(".js-bookmark-category-error-message"),t=$.trim(i.val());if(n.hideErrorMessage(),t==="")return!1;OpenriceApp.Api.abort(n.xhr.bookmark);n.xhr.bookmark=OpenriceApp.Api.Poi.createBookmarkCategory(t,e)};OpenriceApp.Widgets.BookmarkCategory.prototype.onClickPrivateButton=function(){var n=this;$(n.selector).find(".js-public-toggle").off("click").on("click",function(){var n=$(this).siblings(".js-public-toggle-checkbox");$(n).prop("checked",!$(n).prop("checked"))})};OpenriceApp.Widgets.BookmarkCategory.prototype.onClickCategoryItems=function(){var n=this;$(n.selector).find(".js-bookmark-checkbox, .js-name").off("click").on("click",function(){var t=$(this).closest(".js-bookmark-category"),i=$(t).attr("data-bookmark-category-id");$(t).find(".js-bookmark-checkbox").hasClass("bookmarked")?n.dropSelectedItem(i):n.addSelectedItem(i);n.hideCreateBookmarkCategoryInputField()})};OpenriceApp.Widgets.BookmarkCategory.prototype.onClickEditCategoryButton=function(){var n=this;$(n.selector).find(".js-edit-category-btn").off("click").on("click",function(){n.hideErrorMessage();n.hideCreateBookmarkCategoryInputField();$(".show-edit-input").removeClass("show-edit-input");$(".js-category-edit-done-button").removeClass("has-error");var t=$(this).closest(".js-bookmark-category"),i=t.attr("data-bookmark-category-name");t.find(".js-edit-bookmark-category-input").val(i);t.addClass("show-edit-input");n.onInputEditCategoryInput(t)})};OpenriceApp.Widgets.BookmarkCategory.prototype.onInputEditCategoryInput=function(n){var t=this;n.find(".js-edit-bookmark-category-input").on({input:function(){n.find(".js-category-edit-done-button").removeClass("has-error")},keydown:function(i){i.keyCode===13&&t.processEditCategory(n)}})};OpenriceApp.Widgets.BookmarkCategory.prototype.onClickEditCategoryDoneButton=function(){var n=this;$(n.selector).find(".js-category-edit-done-button").off("click").on("click",function(){var t=$(this).closest(".js-bookmark-category");n.processEditCategory(t)})};OpenriceApp.Widgets.BookmarkCategory.prototype.processEditCategory=function(n){function e(f){if(!!f.errorMessage){u.text(f.errorMessage).show();return}t.categoryBlock.hasCategoryItemChange=!0;var e=$(t.selector).find(".catid-"+r);$(e).attr("data-bookmark-category-name",i);$(e).find(".js-name").text(i);$(n).removeClass("show-edit-input")}var t=this,r=$(n).attr("data-bookmark-category-id"),i=$.trim($(n).find(".js-edit-bookmark-category-input").val()),f=$(n).attr("data-bookmark-category-name")+"",u=$(t.selector).find(".js-bookmark-category-error-message");if(u.hide(),i===""||i===f){$(n).removeClass("show-edit-input");return}OpenriceApp.Api.abort(t.xhr.bookmark);t.xhr.bookmark=OpenriceApp.Api.Poi.updateBookmarkCategory(i,r,e)};OpenriceApp.Widgets.BookmarkCategory.prototype.hideErrorMessage=function(){var n=this;$(n.selector).find(".js-bookmark-category-error-message").hide()};OpenriceApp.Widgets.BookmarkCategory.prototype.onClickRemoveCategoryButton=function(){function i(){$(n.selector).find(".catid-"+t).remove();n.removeSelectedItem(t);n.categoryBlock.hasCategoryItemChange=!0;var i=$(n.selector).find(".js-latest-bookmark-categories .js-bookmark-checkbox").length;i<1&&$(".js-latest-bookmark-categories-section").remove()}var n=this,t="";$(n.selector).find(".js-delete-category-btn").off("click").on("click",function(){n.hideErrorMessage();n.hideCreateBookmarkCategoryInputField();t=$(this).closest(".js-bookmark-category").attr("data-bookmark-category-id");OpenriceApp.Api.abort(n.xhr.bookmark);n.xhr.bookmark=OpenriceApp.Api.Poi.deleteBookmarkCategory(t,i)})};OpenriceApp.Widgets.BookmarkCategory.prototype.addSelectedItem=function(n){var t=this;$(t.selector).find('.js-bookmark-checkbox[data-bookmark-category-id="'+n+'"]').addClass("bookmarked");t.categoryBlock.selectedItems.unshift(n)};OpenriceApp.Widgets.BookmarkCategory.prototype.dropSelectedItem=function(n){var t=this;$(t.selector).find('.js-bookmark-checkbox[data-bookmark-category-id="'+n+'"]').removeClass("bookmarked");t.removeSelectedItem(n)};OpenriceApp.Widgets.BookmarkCategory.prototype.removeSelectedItem=function(n){var t=this;t.categoryBlock.selectedItems=$.grep(t.categoryBlock.selectedItems,function(t){return t!=n})};OpenriceApp.Widgets.BookmarkCategory.prototype.submitBookmarkStatus=function(){function f(t){return $(n.selector).find(".js-all-bookmark-categories .js-bookmark-category.catid-"+t).attr("data-bookmark-category-name")}function e(t){if(toastr.options.timeOut=n.defaultToastTimeout,t.success||!(i<1)){if(toastr.remove(),!!t.successMessage){var r=3e3;toastr.options.timeOut=r;toastr.error(t.successMessage);setTimeout(function(){toastr.options.timeOut=n.defaultToastTimeout},r)}n.trigger("bookmark-category:bookmark",n.categoryBlock.poiId);n.refreshCategoryHtml(t)}}var n=this,i=!n.categoryBlock.selectedItems?0:n.categoryBlock.selectedItems.length,r=[],t,u;if(n.categoryBlock.hasCategoryItemChange||!(i<1)){for(t=0;t<i;t++)r.push(f(n.categoryBlock.selectedItems[t]));u={poiId:n.categoryBlock.poiId,categoryIds:n.categoryBlock.selectedItems,categoryNames:r,isPrivate:$(n.selector).find(".js-public-toggle-checkbox").is(":checked")===!1,preselect:n.preselect};OpenriceApp.Api.abort(n.xhr.bookmark);n.xhr.bookmark=OpenriceApp.Api.Poi.bookmark(u,e)}};OpenriceApp.Api.Poi={uiCity:$("body").data("uicity"),uiLang:$("body").data("uilang"),getStatus:function(n,t){var i=this,r={uiCity:i.uiCity,uiLang:i.uiLang,poiId:n};return OpenriceApp.Api.call("/api/poi/status","get",r,t)},directBookmark:function(n,t){var r=this,i={poiId:n.poiId};return OpenriceApp.Api.call("/api/poi/direct-bookmark","put",i,t)},bookmark:function(n,t){var i=this,r={uiLang:i.uiLang,poiId:n.poiId,categoryIds:n.categoryIds,categoryNames:n.categoryNames,isPrivate:n.isPrivate,preselect:!n.preselect?!0:n.preselect};return OpenriceApp.Api.call("/api/poi/bookmark","put",r,t)},unbookmark:function(n,t){var i=this,n={uiLang:i.uiLang,poiId:n.poiId,preselect:!n.preselect?!0:n.preselect};return OpenriceApp.Api.call("/api/poi/bookmark","delete",n,t)},getBookmarkStatus:function(n,t){var i={poiId:n};return OpenriceApp.Api.call("/api/poi/bookmark","get",i,t)},getBookmarkCategory:function(n,t){var i=this,n={uiLang:i.uiLang,preselect:!n.preselect?!0:n.preselect};return OpenriceApp.Api.call("/api/poi/bookmark/category","get",n,t)},createBookmarkCategory:function(n,t){var i=this,r={uiLang:i.uiLang,nameLang1:n};return OpenriceApp.Api.call("/api/poi/bookmark/category","put",r,t)},updateBookmarkCategory:function(n,t,i){var r=this,u={uiLang:r.uiLang,bookmarkCategoryId:t,nameLang1:n};return OpenriceApp.Api.call("/api/poi/bookmark/category","put",u,i)},deleteBookmarkCategory:function(n,t){var i=this,r={uiLang:i.uiLang,bookmarkCategoryId:n};return OpenriceApp.Api.call("/api/poi/bookmark/category","delete",r,t)},sendSearchHistory:function(n,t,i){var r=this,u="/api/poi/sendhistory?"+n,f={uiCity:r.uiCity,uiLang:r.uiLang,userId:t};return OpenriceApp.Api.call(u,"get",f,i)},getQueuingStatus:function(n,t,i){var r=this,u={uiCity:r.uiCity,uiLang:r.uiLang,poiId:n};return OpenriceApp.Api.callNoCache("/api/poi/queuing/status","get",u,t,i)}};OpenriceApp.ListingBookmark={};OpenriceApp.ListingBookmark.Controller={isDirectBookmark:!1,components:{poiIds:[],bookmarkButtons:{}},init:function(){var n=this;OpenriceApp.Class.Event.call(this);n.resetData();n.initBookmarkButtonWidgets();OpenriceApp.Helpers.isLoggedIn()&&n.getBookmarkStatusAll()},initDirectBookmark:function(){var n=this;n.isDirectBookmark=!0;n.init()},resetData:function(){var n=this;n.components.poiIds=[];n.components.bookmarkButtons={}},initBookmarkButtonWidgets:function(){function i(t,i){var r=$(t).data("poi-id");$(t).on("click",function(t){var u,f;t.preventDefault();t.stopPropagation();u={poiId:r};OpenriceApp.Helpers.isMobile&&!OpenriceApp.Helpers.isLoggedIn()?OpenriceApp.Helpers.redirectLogin({isPhoneSignUpOnly:!0}):OpenriceApp.Helpers.isLoginRequired()?OpenriceApp.Helpers.isMobile||$("body").attr("data-is-phone-signup-only",!0):i.isMarked?(OpenriceApp.Api.Poi.unbookmark(u,function(){n.setBookmarkButtonStatus(r,!1)}),n.isDirectBookmark||n.BookmarkCategory.hideCategoryBlock(n.BookmarkCategory,!1)):($("body").trigger("app.ga.add",t),n.isDirectBookmark?OpenriceApp.Api.Poi.directBookmark(u,function(){n.setBookmarkButtonStatus(r,!0)}):(f=$(this).find(".js-bookmark-category-wrapper"),n.BookmarkCategory.initCategoryBlock(f,this)))})}var n=this,t=$(".js-openrice-bookmark");if(OpenriceApp.Helpers.isLoggedIn()&&!n.isDirectBookmark){n.BookmarkCategory=new OpenriceApp.Widgets.BookmarkCategory;n.BookmarkCategory.init();n.BookmarkCategory.on("bookmark-category:bookmark",function(t){n.setBookmarkButtonStatus(t,!0)})}$(t).each(function(t,r){var f=$(r).data("poi-id"),u=new OpenriceApp.Widgets.BookmarkButton(r,{isMarked:!1,isHovered:!1,isDirectBookmark:!1});u.updateCount();u.updateIcon();n.components.bookmarkButtons[f]=u;n.components.poiIds.push(f);i($(r),u)})},getBookmarkStatusAll:function(){var n=this;if(n.components.poiIds.length>0){OpenriceApp.Api.Poi.getBookmarkStatus(n.components.poiIds,t);function t(t){for(var i in t)n.components.bookmarkButtons[i].isMarked=t[i],n.components.bookmarkButtons[i].updateIcon()}}},setBookmarkButtonStatus:function(n,t){var i=this;i.components.bookmarkButtons[n].isMarked=t;i.components.bookmarkButtons[n].toggleDataCount();i.components.bookmarkButtons[n].updateCount();i.components.bookmarkButtons[n].updateIcon()}};OpenriceApp.ArticleDetail={};OpenriceApp.ArticleDetail.Controller={components:{},data:{},param:{},init:function(){var n=this;n.initDotDotDot();n.initFacebookSdk();n.initAddViewCount();n.ShareButtons.init();n.initBookmarkButtons();n.initViewMoreButton();OpenriceApp.Widgets.BackToTopButton(".js-back-to-top-button")},initFacebookSdk:function(){(new OpenriceApp.Widgets.FaceBookSDK).init()},initDotDotDot:function(){$(".js-text").dotdotdot({wrap:"letter",fallbackToLetter:!0,watch:!0})},initAddViewCount:function(){var n=$(".js-article").data("articleid");setTimeout(function(){OpenriceApp.Api.Article.addViewCount(n)},3e3)},initViewMoreButton:function(){var t=this,n=$(".js-article-detail-viewmore-button-container");if(console.log("button",n),!(n.length<1))$(n).on("click",function(){$(this).find(".js-article-detail-viewmore-button,.js-article-detail-viewless-button").toggle();$(this).parents(".js-article-related-pois-container").find(".js-in-more").toggle()})},initBookmarkButtons:function(){var n=this,t=$(".js-openrice-bookmark");if(!(t.length<1))OpenriceApp.on("ready",function(){n.BookmarkButtons=OpenriceApp.ListingBookmark.Controller;n.BookmarkButtons.init()})}};OpenriceApp.ArticleDetail.Controller.ShareButtons={init:function(){var n=new OpenriceApp.Widgets.ShareMedia($("#articleContainer .js-shareMedia,.sticky-share .js-shareMedia"));n.init();this.initFloatingShare()},initFloatingShare:function(){var t=$(".js-floating-checker").length?$(".js-floating-checker").offset().top+$(".js-floating-checker").outerHeight():0,n=$(".sticky-share .js-shareMedia");$(document).on("scroll",function(){$(document).scrollTop()>t?$(n).removeClass("hide-element"):$(n).addClass("hide-element")}).scroll()}};OpenriceApp.Api.Article={uiLang:$("body").data("uilang"),addViewCount:function(n,t,i,r){var u=this,f={articleId:n,uiLang:u.uiLang};return OpenriceApp.Api.call("/api/article/addviewcount","post",f,t,i,r)}}